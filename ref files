// ./main.dart

import 'package:awesome_notifications/awesome_notifications.dart';
import 'package:yoto/AuthScreen.dart';
import 'package:yoto/firebase_options.dart';
import 'package:yoto/screens/Home/HomeScreen.dart';
import 'package:yoto/screens/Profile/ProfileEditScreen.dart';
import 'package:yoto/services/GraphQLService.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';
import 'package:firebase_core/firebase_core.dart';
import 'package:yoto/services/NotificationService.dart';
import 'package:yoto/screens/Chat/ChatScreen.dart';
// Import other necessary files

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(options: DefaultFirebaseOptions.currentPlatform);

  final notificationService = NotificationService();
  await notificationService.init();

  AwesomeNotifications().setListeners(
    onActionReceivedMethod: onActionReceivedMethod,
  );
  runApp(MyApp());
}

class MyApp extends StatefulWidget {
  @override
  _MyAppState createState() => _MyAppState();
}

class _MyAppState extends State<MyApp> {
  final GlobalKey<NavigatorState> navigatorKey = GlobalKey<NavigatorState>();

  @override
  void initState() {
    super.initState();
  }

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      navigatorKey: navigatorKey,
      title: 'Chat App',
      theme: ThemeData(
        primarySwatch: Colors.teal,
        brightness: Brightness.light,
      ),
      darkTheme: ThemeData(
        primarySwatch: Colors.teal,
        brightness: Brightness.dark,
      ),
      themeMode: ThemeMode.system,
      home: AuthWrapper(),
      routes: {
        '/home': (context) => HomeScreen(),
        '/auth': (context) => AuthScreen(),
        '/profile': (context) => ProfileEditScreen(),
        '/chat': (context) {
          final args = ModalRoute.of(context)!.settings.arguments
              as Map<String, dynamic>;
          return PermanentChatScreen(
            chatId: args['chatId'],
            friendId: args['friendId'],
          );
        },
      },
    );
  }
}

class AuthWrapper extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return StreamBuilder<User?>(
      stream: FirebaseAuth.instance.authStateChanges(),
      builder: (context, snapshot) {
        if (snapshot.connectionState == ConnectionState.waiting) {
          return LoadingScreen();
        } else if (snapshot.hasData) {
          return FutureBuilder<Map<String, dynamic>?>(
            future: Graphqlservice().getUserProfile(),
            builder: (context, profileSnapshot) {
              if (profileSnapshot.connectionState == ConnectionState.waiting) {
                return LoadingScreen();
              }
              if (profileSnapshot.hasError) {
                print('Error fetching user profile: ${profileSnapshot.error}');
                return ErrorScreen(
                  message: 'Failed to load profile. Please try again.',
                  onRetry: () =>
                      Navigator.of(context).pushReplacementNamed('/'),
                );
              }
              if (profileSnapshot.data == null ||
                  profileSnapshot.data!['profileCompleted'] == false) {
                // User doesn't have a profile or profile is not completed
                return ProfileEditScreen(
                    isNewUser: profileSnapshot.data == null);
              }
              // Profile exists and is completed
              return HomeScreen();
            },
          );
        } else {
          return AuthScreen();
        }
      },
    );
  }
}

class LoadingScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Center(
        child: CircularProgressIndicator(),
      ),
    );
  }
}

class ErrorScreen extends StatelessWidget {
  final String message;
  final VoidCallback onRetry;

  const ErrorScreen({Key? key, required this.message, required this.onRetry})
      : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Text(message, textAlign: TextAlign.center),
            SizedBox(height: 20),
            ElevatedButton(
              onPressed: onRetry,
              child: Text('Retry'),
            ),
          ],
        ),
      ),
    );
  }
}



// ./combined_files.txt




// ./AuthScreen.dart

import 'package:yoto/components/auth_button.dart';
import 'package:yoto/components/customer_text_field.dart';
import 'package:flutter/material.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:yoto/screens/Home/HomeScreen.dart';
import 'package:yoto/services/AuthService.dart';

class AuthScreen extends StatefulWidget {
  const AuthScreen({Key? key}) : super(key: key);

  @override
  State<AuthScreen> createState() => _AuthScreenState();
}

class _AuthScreenState extends State<AuthScreen> {
  final _formKey = GlobalKey<FormState>();
  final emailController = TextEditingController();
  final passController = TextEditingController();
  bool isLogin = true;
  final AuthService _authService = AuthService();

  @override
  void dispose() {
    emailController.dispose();
    passController.dispose();
    super.dispose();
  }

  void _toggleAuthMode() {
    setState(() {
      isLogin = !isLogin;
    });
  }

  Future<void> _submitForm() async {
    if (_formKey.currentState?.validate() ?? false) {
      try {
        final email = emailController.text.trim();
        final password = passController.text.trim();

        User? user;
        if (isLogin) {
          user = await _authService.signIn(email, password);
        } else {
          user = await _authService.signUp(email, password);
        }

        if (user != null) {
          Navigator.of(context).pushReplacementNamed('/');
        }
      } catch (e) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text(e.toString())),
        );
      }
    }
  }

  @override
  Widget build(BuildContext context) {
    final isDarkMode = Theme.of(context).brightness == Brightness.dark;

    return Scaffold(
      backgroundColor: isDarkMode ? Colors.black : Colors.white,
      body: SafeArea(
        child: Center(
          child: SingleChildScrollView(
            child: Padding(
              padding: const EdgeInsets.all(24.0),
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Icon(
                    Icons.chat_bubble_outline,
                    size: 80,
                    color: isDarkMode
                        ? Theme.of(context).highlightColor
                        : Theme.of(context).primaryColor,
                  ),
                  const SizedBox(height: 24),
                  Text(
                    isLogin ? 'Welcome Back' : 'Create Account',
                    style: TextStyle(
                      fontSize: 28,
                      fontWeight: FontWeight.bold,
                      color: isDarkMode ? Colors.white : Colors.black,
                    ),
                  ),
                  const SizedBox(height: 24),
                  Form(
                    key: _formKey,
                    child: Column(
                      children: [
                        CustomTextField(
                          controller: emailController,
                          hintText: 'Email',
                          icon: Icons.email_outlined,
                          validator: _authService.validateEmail,
                        ),
                        const SizedBox(height: 16),
                        CustomTextField(
                          controller: passController,
                          hintText: 'Password',
                          icon: Icons.lock_outline,
                          obscureText: true,
                          validator: _authService.validatePassword,
                        ),
                      ],
                    ),
                  ),
                  const SizedBox(height: 24),
                  AuthButton(
                    text: isLogin ? 'Log In' : 'Sign Up',
                    onPressed: _submitForm,
                  ),
                  const SizedBox(height: 16),
                  TextButton(
                    onPressed: _toggleAuthMode,
                    child: Text(
                      isLogin
                          ? 'Don\'t have an account? Sign Up'
                          : 'Already have an account? Log In',
                      style: TextStyle(
                          color: Theme.of(context).colorScheme.secondary),
                    ),
                  ),
                ],
              ),
            ),
          ),
        ),
      ),
    );
  }
}



// ./components/search_button.dart

import 'package:flutter/material.dart';

class SearchButton extends StatelessWidget {
  final bool isSearching;
  final VoidCallback onStartSearch;
  final VoidCallback onStopSearch;

  const SearchButton({
    Key? key,
    required this.isSearching,
    required this.onStartSearch,
    required this.onStopSearch,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return isSearching
        ? ElevatedButton(
            onPressed: onStopSearch,
            style: ElevatedButton.styleFrom(backgroundColor: Colors.red),
            child: const Text('Stop Search'),
          )
        : ElevatedButton(
            onPressed: onStartSearch,
            child: const Text('Start Search'),
          );
  }
}



// ./components/customer_text_field.dart

import 'package:flutter/material.dart';

class CustomTextField extends StatelessWidget {
  final TextEditingController controller;
  final String hintText;
  final IconData icon;
  final bool obscureText;
  final String? Function(String?)? validator;

  const CustomTextField({
    Key? key,
    required this.controller,
    required this.hintText,
    required this.icon,
    this.obscureText = false,
    this.validator,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    final isDarkMode = Theme.of(context).brightness == Brightness.dark;

    return TextFormField(
      controller: controller,
      obscureText: obscureText,
      decoration: InputDecoration(
        hintText: hintText,
        prefixIcon: Icon(icon, color: Theme.of(context).primaryColor),
        border: OutlineInputBorder(
          borderRadius: BorderRadius.circular(30),
          borderSide: BorderSide(color: Theme.of(context).primaryColor),
        ),
        focusedBorder: OutlineInputBorder(
          borderRadius: BorderRadius.circular(30),
          borderSide:
              BorderSide(color: Theme.of(context).primaryColor, width: 2),
        ),
        fillColor: isDarkMode ? Colors.grey[800] : Colors.grey[200],
        filled: true,
      ),
      style: TextStyle(color: isDarkMode ? Colors.white : Colors.black),
      validator: validator,
    );
  }
}



// ./components/full_screen_profile_pic.dart

import 'package:flutter/material.dart';

class FullScreenImageViewer extends StatelessWidget {
  final String imageUrl;

  const FullScreenImageViewer({Key? key, required this.imageUrl})
      : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.black,
      body: GestureDetector(
        onTap: () => Navigator.pop(context),
        child: Center(
          child: Hero(
            tag: 'profileImage',
            child: Image.network(
              imageUrl,
              fit: BoxFit.contain,
            ),
          ),
        ),
      ),
    );
  }
}



// ./components/chat_input.dart

import 'package:flutter/material.dart';

class ChatInput extends StatefulWidget {
  final Function(String) onSendMessage;

  const ChatInput({Key? key, required this.onSendMessage}) : super(key: key);

  @override
  _ChatInputState createState() => _ChatInputState();
}

class _ChatInputState extends State<ChatInput> {
  final TextEditingController _messageController = TextEditingController();

  void _sendMessage() {
    if (_messageController.text.trim().isNotEmpty) {
      widget.onSendMessage(_messageController.text.trim());
      _messageController.clear();
    }
  }

  @override
  Widget build(BuildContext context) {
    return Container(
      padding: EdgeInsets.symmetric(horizontal: 8.0),
      decoration: BoxDecoration(
        color: Colors.white,
        boxShadow: [
          BoxShadow(
              color: Colors.grey.withOpacity(0.5),
              spreadRadius: 1,
              blurRadius: 5,
              offset: Offset(0, 3))
        ],
      ),
      child: Row(
        children: [
          Expanded(
            child: TextField(
              controller: _messageController,
              decoration: InputDecoration(
                  hintText: 'Type a message...', border: InputBorder.none),
            ),
          ),
          IconButton(
              icon: Icon(Icons.send, color: Colors.blue),
              onPressed: _sendMessage),
        ],
      ),
    );
  }

  @override
  void dispose() {
    _messageController.dispose();
    super.dispose();
  }
}



// ./components/message_bubble.dart

import 'package:flutter/material.dart';

class MessageBubble extends StatelessWidget {
  final Map<String, dynamic> message;
  final bool isMe;

  const MessageBubble({Key? key, required this.message, required this.isMe})
      : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Align(
      alignment: isMe ? Alignment.centerRight : Alignment.centerLeft,
      child: Container(
        margin: EdgeInsets.symmetric(vertical: 4, horizontal: 8),
        padding: EdgeInsets.symmetric(vertical: 10, horizontal: 14),
        decoration: BoxDecoration(
          color: isMe ? Colors.blue[400] : Colors.grey[300],
          borderRadius: BorderRadius.circular(18),
        ),
        child: Text(
          message['content'],
          style: TextStyle(color: isMe ? Colors.white : Colors.black),
        ),
      ),
    );
  }
}



// ./components/auth_button.dart

import 'package:flutter/material.dart';

class AuthButton extends StatelessWidget {
  final String text;
  final VoidCallback onPressed;

  const AuthButton({Key? key, required this.text, required this.onPressed}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return ElevatedButton(
      onPressed: onPressed,
      child: Text(text, style: TextStyle(color: Colors.white)),
      style: ElevatedButton.styleFrom(
        backgroundColor: Theme.of(context).primaryColor,
        padding: EdgeInsets.symmetric(horizontal: 50, vertical: 15),
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(30),
        ),
      ),
    );
  }
}


// ./components/timer_display.dart

import 'package:flutter/material.dart';
import 'dart:async';

class TimerDisplay extends StatefulWidget {
  final String chatId;

  const TimerDisplay({Key? key, required this.chatId}) : super(key: key);

  @override
  _TimerDisplayState createState() => _TimerDisplayState();
}

class _TimerDisplayState extends State<TimerDisplay> {
  late Timer _timer;
  int _remainingSeconds = 15 * 60; // 15 minutes

  @override
  void initState() {
    super.initState();
    _startTimer();
  }

  void _startTimer() {
    _timer = Timer.periodic(Duration(seconds: 1), (timer) {
      setState(() {
        if (_remainingSeconds > 0) {
          _remainingSeconds--;
        } else {
          _timer.cancel();
          // Handle chat end here
        }
      });
    });
  }

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(8.0),
      child: Text(
        'Time remaining: ${_remainingSeconds ~/ 60}:${(_remainingSeconds % 60).toString().padLeft(2, '0')}',
        style: TextStyle(fontWeight: FontWeight.bold),
      ),
    );
  }

  @override
  void dispose() {
    _timer.cancel();
    super.dispose();
  }
}



// ./components/message_bubble_with_media.dart

import 'package:flutter/material.dart';
import 'package:video_player/video_player.dart';
import 'package:audioplayers/audioplayers.dart';
import 'package:flutter/foundation.dart' show kIsWeb;
import 'package:photo_view/photo_view.dart';
import 'package:chewie/chewie.dart';

class MessageBubbleWithMedia extends StatelessWidget {
  final Map<String, dynamic> message;
  final bool isMe;

  const MessageBubbleWithMedia(
      {Key? key, required this.message, required this.isMe})
      : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Align(
      alignment: isMe ? Alignment.centerRight : Alignment.centerLeft,
      child: Container(
        margin: EdgeInsets.symmetric(vertical: 4, horizontal: 8),
        padding: EdgeInsets.all(8),
        decoration: BoxDecoration(
          color: isMe ? Colors.blue : Colors.grey[300],
          borderRadius: BorderRadius.circular(12),
        ),
        child: _buildMessageContent(context),
      ),
    );
  }

  Widget _buildMessageContent(BuildContext context) {
    if (message['mediaType'] == 'photo') {
      return _buildPhotoContent(context);
    } else if (message['mediaType'] == 'video') {
      return _buildVideoContent(context);
    } else if (message['mediaType'] == 'audio') {
      return AudioPlayerWidget(audioUrl: message['mediaUrl']);
    } else {
      return Text(
        message['text'] ?? '',
        style: TextStyle(color: isMe ? Colors.white : Colors.black),
      );
    }
  }

  Widget _buildPhotoContent(BuildContext context) {
    return GestureDetector(
      onTap: () => _showFullScreenImage(context, message['mediaUrl']),
      child: message['isUploading'] == true
          ? _buildUploadingIndicator()
          : Image.network(
              message['mediaUrl'],
              width: 200,
              height: 200,
              fit: BoxFit.cover,
              loadingBuilder: (context, child, loadingProgress) {
                if (loadingProgress == null) return child;
                return _buildUploadingIndicator(
                  value: loadingProgress.expectedTotalBytes != null
                      ? loadingProgress.cumulativeBytesLoaded /
                          loadingProgress.expectedTotalBytes!
                      : null,
                );
              },
            ),
    );
  }

  Widget _buildVideoContent(BuildContext context) {
    return message['isUploading'] == true
        ? _buildUploadingIndicator()
        : VideoPlayerWidget(videoUrl: message['mediaUrl']);
  }

  Widget _buildUploadingIndicator({double? value}) {
    return Container(
      width: 200,
      height: 200,
      color: Colors.grey[200],
      child: Center(
        child: CircularProgressIndicator(value: value),
      ),
    );
  }

  void _showFullScreenImage(BuildContext context, String imageUrl) {
    Navigator.of(context).push(MaterialPageRoute(
      builder: (context) => Scaffold(
        body: Container(
          child: PhotoView(
            imageProvider: NetworkImage(imageUrl),
            minScale: PhotoViewComputedScale.contained,
            maxScale: PhotoViewComputedScale.covered * 2,
          ),
        ),
      ),
    ));
  }
}

class VideoPlayerWidget extends StatefulWidget {
  final String videoUrl;

  const VideoPlayerWidget({Key? key, required this.videoUrl}) : super(key: key);

  @override
  _VideoPlayerWidgetState createState() => _VideoPlayerWidgetState();
}

class _VideoPlayerWidgetState extends State<VideoPlayerWidget> {
  late VideoPlayerController _videoPlayerController;
  late ChewieController _chewieController;
  bool _isInitialized = false;

  @override
  void initState() {
    super.initState();
    _initializePlayer();
  }

  void _initializePlayer() async {
    _videoPlayerController = VideoPlayerController.network(widget.videoUrl);
    await _videoPlayerController.initialize();
    _chewieController = ChewieController(
      videoPlayerController: _videoPlayerController,
      aspectRatio: _videoPlayerController.value.aspectRatio,
      autoPlay: false,
      looping: false,
    );
    setState(() {
      _isInitialized = true;
    });
  }

  @override
  Widget build(BuildContext context) {
    return _isInitialized
        ? AspectRatio(
            aspectRatio: _videoPlayerController.value.aspectRatio,
            child: Chewie(controller: _chewieController),
          )
        : Container(
            height: 200,
            child: Center(child: CircularProgressIndicator()),
          );
  }

  @override
  void dispose() {
    _videoPlayerController.dispose();
    _chewieController.dispose();
    super.dispose();
  }
}

class AudioPlayerWidget extends StatefulWidget {
  final String audioUrl;

  const AudioPlayerWidget({Key? key, required this.audioUrl}) : super(key: key);

  @override
  _AudioPlayerWidgetState createState() => _AudioPlayerWidgetState();
}

class _AudioPlayerWidgetState extends State<AudioPlayerWidget> {
  final AudioPlayer _audioPlayer = AudioPlayer();
  PlayerState _playerState = PlayerState.stopped;
  Duration _duration = Duration.zero;
  Duration _position = Duration.zero;

  @override
  void initState() {
    super.initState();
    _initAudioPlayer();
  }

  void _initAudioPlayer() {
    _audioPlayer.onPlayerStateChanged.listen((state) {
      setState(() {
        _playerState = state;
      });
    });

    _audioPlayer.onDurationChanged.listen((newDuration) {
      setState(() {
        _duration = newDuration;
      });
    });

    _audioPlayer.onPositionChanged.listen((newPosition) {
      setState(() {
        _position = newPosition;
      });
    });
  }

  @override
  Widget build(BuildContext context) {
    return Row(
      mainAxisSize: MainAxisSize.min,
      children: [
        IconButton(
          icon: Icon(_playerState == PlayerState.playing
              ? Icons.pause
              : Icons.play_arrow),
          onPressed: _togglePlayPause,
        ),
        Expanded(
          child: Slider(
            value: _position.inSeconds.toDouble(),
            max: _duration.inSeconds.toDouble(),
            onChanged: (value) {
              final position = Duration(seconds: value.toInt());
              _audioPlayer.seek(position);
            },
          ),
        ),
        Text(
          '${_position.inMinutes}:${(_position.inSeconds % 60).toString().padLeft(2, '0')}',
          style: TextStyle(fontSize: 12),
        ),
      ],
    );
  }

  void _togglePlayPause() {
    if (_playerState == PlayerState.playing) {
      _audioPlayer.pause();
    } else {
      _audioPlayer.play(UrlSource(widget.audioUrl));
    }
  }

  @override
  void dispose() {
    _audioPlayer.dispose();
    super.dispose();
  }
}



// ./services/LocationService.dart

import 'package:flutter/material.dart';
import 'package:geolocator/geolocator.dart';

class LocationService {
  Future<Position?> getCurrentLocation(BuildContext context) async {
    bool serviceEnabled;
    LocationPermission permission;

    serviceEnabled = await Geolocator.isLocationServiceEnabled();
    if (!serviceEnabled) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
            content: Text(
                'Location services are disabled. Please enable the services')),
      );
      return null;
    }

    permission = await Geolocator.checkPermission();
    if (permission == LocationPermission.denied) {
      permission = await Geolocator.requestPermission();
      if (permission == LocationPermission.denied) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('Location permissions are denied')),
        );
        return null;
      }
    }

    if (permission == LocationPermission.deniedForever) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
            content: Text(
                'Location permissions are permanently denied, we cannot request permissions.')),
      );
      return null;
    }

    try {
      return await Geolocator.getCurrentPosition();
    } catch (e) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('Error getting location: $e')),
      );
      return null;
    }
  }
}



// ./services/ChatService.dart




// ./services/NotificationService.dart

import 'package:awesome_notifications/awesome_notifications.dart';
import 'package:flutter/material.dart';

class NotificationService {
  static final NotificationService _instance = NotificationService._internal();

  factory NotificationService() {
    return _instance;
  }

  NotificationService._internal();

  Future<void> init() async {
    await AwesomeNotifications().initialize(
      null, // no icon for iOS
      [
        NotificationChannel(
          channelKey: 'basic_channel',
          channelName: 'Basic Notifications',
          channelDescription: 'Notification channel for basic tests',
          defaultColor: Color(0xFF9D50DD),
          ledColor: Colors.white,
          importance: NotificationImportance.High,
        ),
        NotificationChannel(
          channelKey: 'input_channel',
          channelName: 'Input Notifications',
          channelDescription: 'Notification channel for inputs',
          defaultColor: Color(0xFF9D50DD),
          ledColor: Colors.white,
          importance: NotificationImportance.High,
        )
      ],
    );
  }

  Future<void> showNotification({
    required int id,
    required String title,
    required String body,
  }) async {
    await AwesomeNotifications().createNotification(
      content: NotificationContent(
        id: id,
        channelKey: 'basic_channel',
        title: title,
        body: body,
      ),
    );
  }

  Future<void> showNotificationWithQuickReply({
    required int id,
    required String title,
    required String body,
    required List<String> replyChoices,
  }) async {
    await AwesomeNotifications().createNotification(
      content: NotificationContent(
        id: id,
        channelKey: 'input_channel',
        title: title,
        body: body,
        notificationLayout: NotificationLayout.BigText,
      ),
      actionButtons: [
        NotificationActionButton(
          key: 'REPLY',
          label: 'Reply',
          requireInputText: true,
          actionType: () {
            // to do something when the user replies
            return ActionType.DismissAction;
          }(),
        ),
      ],
    );
  }

  Future<void> cancelNotification(int id) async {
    await AwesomeNotifications().cancel(id);
  }

  Future<void> cancelAllNotifications() async {
    await AwesomeNotifications().cancelAll();
  }
}

@pragma('vm:entry-point')
Future<void> onActionReceivedMethod(ReceivedAction receivedAction) async {
  if (receivedAction.buttonKeyInput == true) {
    // This is the text input from the reply
    print('User replied: ${receivedAction.buttonKeyInput}');
  } else if (receivedAction.buttonKeyPressed == true) {
    // This is for predefined quick actions
    print('User selected quick reply: ${receivedAction.buttonKeyPressed}');
  }
}



// ./services/ServerlessService.dart

import 'dart:async';
import 'package:intl/intl.dart'; // Make sure to add this package to your pubspec.yaml
import 'package:http/http.dart' as http;
import 'dart:convert';
import 'package:firebase_auth/firebase_auth.dart';

class ServerlessService {
  final String baseUrl =
      'https://d9cuoxk4x9.execute-api.ap-south-1.amazonaws.com/Prod';

  final FirebaseAuth _auth = FirebaseAuth.instance;
  Future<String?> _getIdToken() async {
    User? user = _auth.currentUser;
    if (user != null) {
      return await user.getIdToken();
    }
    return null;
  }

  Future<void> updateProfile(Map<String, dynamic> userData,
      {bool isNew = false}) async {
    try {
      userData['isNew'] = isNew;

      Map<String, dynamic> sanitizedUserData = userData.map((key, value) {
        if (value is DateTime) {
          return MapEntry(key, DateFormat('yyyy-MM-dd').format(value));
        }
        return MapEntry(key, value);
      });

      String? idToken = await _getIdToken();
      if (idToken == null) {
        throw Exception('User not authenticated');
      }

      print(json.encode(sanitizedUserData));

      final Uri uri = Uri.parse('$baseUrl/userProfile/');

      final response = await http
          .post(
        uri,
        headers: {
          'Content-Type': 'application/json',
          'Access-Control-Allow-Origin': '*',
          'Authorization': 'Bearer $idToken',
        },
        body: json.encode(sanitizedUserData),
      )
          .timeout(Duration(seconds: 30), onTimeout: () {
        throw TimeoutException(
            'The connection has timed out, please try again.');
      });

      if (response.statusCode != 200) {
        throw Exception(
            'Failed to ${isNew ? 'create' : 'update'}: ${response.body}');
      }
    } catch (e, stackTrace) {
      print('Error in updateProfile: $e');
      print('Stack trace: $stackTrace');
      rethrow; // Re-throw the exception after logging
    }
  }

  Future<void> addToMatchQueue(Map<String, dynamic> userData) async {
    String? idToken = await _getIdToken();
    if (idToken == null) {
      throw Exception('User not authenticated');
    }

    final response = await http.post(
      Uri.parse('$baseUrl/addToMatchQueue'),
      headers: {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': '*', // Allow all origins
        'Authorization': 'Bearer $idToken',
      },
      body: json.encode(userData),
    );

    if (response.statusCode != 200) {
      throw Exception('Failed to add to match queue: ${response.body}');
    }
  }

  Future<void> removeFromMatchQueue() async {
    String? idToken = await _getIdToken();
    if (idToken == null) {
      throw Exception('User not authenticated');
    }

    final response = await http.post(
      Uri.parse('$baseUrl/removeFromMatchQueue'),
      headers: {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': '*', // Allow all origins
        'Authorization': 'Bearer $idToken',
      },
    );

    if (response.statusCode != 200) {
      throw Exception('Failed to remove from match queue: ${response.body}');
    }
  }
}



// ./services/SocketService.dart

import 'package:socket_io_client/socket_io_client.dart' as IO;

class SocketService {
  late IO.Socket socket;
  final String userId;
  Function(List<Map<String, dynamic>>)? onFriendsListUpdate;
  Function(Map<String, dynamic>)? onUserProfileUpdate;

  SocketService(this.userId);

  void connect() {
    socket = IO.io(
        'https://e682-2409-40c1-10ff-b39c-45be-1415-f564-fdc9.ngrok-free.app',
        <String, dynamic>{
          'transports': ['websocket'],
          'autoConnect': false,
        });

    socket.connect();
    socket.emit('register', userId);

    socket.on('connect', (_) => print('Connected to socket server'));
    socket.on('initialFriendsList', _handleInitialFriendsList);
    socket.on('friendsListUpdate', _handleFriendsListUpdate);
    socket.on('userProfileUpdate', _handleUserProfileUpdate);
    socket.on('error', (data) => print('Socket error: $data'));
  }

  void _handleInitialFriendsList(dynamic data) {
    if (data is List) {
      final friendsList = data.cast<Map<String, dynamic>>();
      if (onFriendsListUpdate != null) {
        onFriendsListUpdate!(friendsList);
      }
    }
  }

  void _handleFriendsListUpdate(dynamic data) {
    if (data is List) {
      final friendsList = data.cast<Map<String, dynamic>>();
      if (onFriendsListUpdate != null) {
        onFriendsListUpdate!(friendsList);
      }
    }
  }

  void _handleUserProfileUpdate(dynamic data) {
    if (data is Map) {
      final profileUpdate = Map<String, dynamic>.from(data);
      if (onUserProfileUpdate != null) {
        onUserProfileUpdate!(profileUpdate);
      }
    }
  }

  void disconnect() {
    socket.disconnect();
  }
}



// ./services/AuthService.dart

import 'package:firebase_auth/firebase_auth.dart';

class AuthService {
  final FirebaseAuth _auth = FirebaseAuth.instance;

  Future<User?> signIn(String email, String password) async {
    try {
      UserCredential result = await _auth.signInWithEmailAndPassword(
        email: email,
        password: password,
      );
      return result.user;
    } catch (e) {
      throw _handleAuthException(e);
    }
  }

  Future<User?> signUp(String email, String password) async {
    try {
      UserCredential result = await _auth.createUserWithEmailAndPassword(
        email: email,
        password: password,
      );
      return result.user;
    } catch (e) {
      throw _handleAuthException(e);
    }
  }

  String _handleAuthException(dynamic e) {
    if (e is FirebaseAuthException) {
      switch (e.code) {
        case 'user-not-found':
          return 'No user found with this email.';
        case 'wrong-password':
          return 'Wrong password provided.';
        case 'email-already-in-use':
          return 'The email address is already in use.';
        default:
          return 'An error occurred. Please try again.';
      }
    }
    return 'An unexpected error occurred.';
  }

  String? validateEmail(String? value) {
    if (value?.isEmpty ?? true) {
      return 'Please enter your email';
    }
    final emailRegex = RegExp(r'^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$');
    if (!emailRegex.hasMatch(value!)) {
      return 'Please enter a valid email address';
    }
    return null;
  }

  String? validatePassword(String? value) {
    if (value?.isEmpty ?? true) {
      return 'Please enter your password';
    }
    if (value!.length < 6) {
      return 'Password should be at least 6 characters';
    }
    return null;
  }
}


// ./services/AppStateService.dart

enum AppScreen {
  friendsList,
  chat,
  other,
}

class AppState {
  static AppScreen currentScreen = AppScreen.other;
  static String? currentChatId;
}



// ./services/MatchService.dart

// match_service.dart

import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:geolocator/geolocator.dart';

class MatchService {
  final FirebaseFirestore _firestore = FirebaseFirestore.instance;

  Future<String?> findMatch(String userId) async {
    try {
      final queueSnapshot = await _firestore
          .collection('matchQueue')
          .where('userId', isNotEqualTo: userId)
          .get();

      if (queueSnapshot.docs.isEmpty) {
        print('No other users in the match queue.');
        return null;
      }

      // Simply choose the first available user in the queue
      final matchedUser = queueSnapshot.docs.first;
      final matchedUserId = matchedUser['userId'] as String?;
      final matchedDocId = matchedUser.id;

      if (matchedUserId != null) {
        // Calculate score for logging purposes, but don't use it for matching
        final userDoc = await _firestore.collection('users').doc(userId).get();
        final userData = userDoc.data() ?? {};
        double score = calculateMatchScore(userData, matchedUser.data());

        await _removeFromQueue(userId, matchedUserId, matchedDocId);
        await _createMatch(userId, matchedUserId, score);
        print('Match found with user: $matchedUserId, score: $score');
        return matchedUserId;
      }

      print('No suitable match found at this time.');
      return null;
    } catch (e) {
      print("Error finding match: $e");
      return null;
    }
  }

  double calculateMatchScore(
      Map<String, dynamic> user1, Map<String, dynamic> user2) {
    double score = 0;
    int factorsConsidered = 0;

    // Location-based matching
    if (user1['latitude'] != null &&
        user1['longitude'] != null &&
        user2['latitude'] != null &&
        user2['longitude'] != null) {
      double distance = Geolocator.distanceBetween(
        user1['latitude'],
        user1['longitude'],
        user2['latitude'],
        user2['longitude'],
      );
      score += 50 * (1 - (distance / 100000)); // Assumes 100km as max distance
      factorsConsidered++;
    }

    // Age-based matching
    if (user1['birthdate'] != null && user2['birthdate'] != null) {
      Timestamp birthdate1 = user1['birthdate'];
      Timestamp birthdate2 = user2['birthdate'];
      int age1 = calculateAgeFromTimestamp(birthdate1);
      int age2 = calculateAgeFromTimestamp(birthdate2);
      int ageDifference = (age1 - age2).abs();
      score += 50 *
          (1 - (ageDifference / 10)); // Assumes 10 years as max age difference
      factorsConsidered++;
    }

    // Gender matching (optional)
    if (user1['gender'] != null && user2['gender'] != null) {
      if (user1['gender'] != user2['gender']) {
        score += 50;
      }
      factorsConsidered++;
    }

    // Calculate average score based on factors considered
    return factorsConsidered > 0 ? score / factorsConsidered : 0;
  }

  Future<void> _removeFromQueue(
      String userId, String matchedUserId, String matchedDocId) async {
    await _firestore.collection('matchQueue').doc(matchedDocId).delete();
    await _firestore
        .collection('matchQueue')
        .where('userId', isEqualTo: userId)
        .get()
        .then((snapshot) {
      for (var doc in snapshot.docs) {
        doc.reference.delete();
      }
    });
  }

  Future<void> _createMatch(
      String userId, String matchedUserId, double score) async {
    final matchRef = _firestore.collection('matches').doc();
    final matchId = matchRef.id;

    await matchRef.set({
      'users': [userId, matchedUserId],
      'timestamp': FieldValue.serverTimestamp(),
      'score': score,
    });

    await _firestore
        .collection('matches')
        .doc(userId)
        .collection('userMatches')
        .doc(matchId)
        .set({
      'matchedUserId': matchedUserId,
      'timestamp': FieldValue.serverTimestamp(),
      'score': score,
    });

    await _firestore
        .collection('matches')
        .doc(matchedUserId)
        .collection('userMatches')
        .doc(matchId)
        .set({
      'matchedUserId': userId,
      'timestamp': FieldValue.serverTimestamp(),
      'score': score,
    });
  }

  int calculateAgeFromTimestamp(Timestamp birthdate) {
    DateTime currentDate = DateTime.now();
    DateTime birthdateDateTime = birthdate.toDate();
    int age = currentDate.year - birthdateDateTime.year;
    int month1 = currentDate.month;
    int month2 = birthdateDateTime.month;
    if (month2 > month1) {
      age--;
    } else if (month1 == month2) {
      int day1 = currentDate.day;
      int day2 = birthdateDateTime.day;
      if (day2 > day1) {
        age--;
      }
    }
    return age;
  }
}



// ./services/GraphQLService.dart

import 'dart:convert';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:flutter/material.dart';
import 'package:http/http.dart' as http;
import 'package:firebase_auth/firebase_auth.dart';

class Graphqlservice {
  static final String url =
      'https://d9cuoxk4x9.execute-api.ap-south-1.amazonaws.com/Prod/graphql/';

  static Future<String?> _getToken() async {
    final FirebaseAuth _auth = FirebaseAuth.instance;
    final User? user = _auth.currentUser;
    return await user?.getIdToken();
  }

  static Future<Map<String, dynamic>?> _sendRequest(String query,
      {Map<String, dynamic>? variables}) async {
    final String? token = await _getToken();

    if (token == null) {
      throw Exception('User not authenticated');
    }

    print('Token (first 10 chars): ${token.substring(0, 10)}...');

    final headers = {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer $token'
    };

    final body = jsonEncode({'query': query, 'variables': variables ?? {}});

    final response = await http.post(
      Uri.parse(url),
      headers: headers,
      body: body,
    );

    if (response.statusCode == 200) {
      return jsonDecode(response.body);
    } else {
      return null;
    }
  }

  Future<Map<String, dynamic>?> getUserProfile() async {
    const String query = '''
      query {
        getUserProfile {
          displayName
          bio
          profileCompleted
          birthDate
          profileImageUrl
          gender
        }
      }
    ''';

    final result = await _sendRequest(query);

    if (result == null || result['errors'] != null) {
      print('GraphQL query error: ${result?['errors']}');
      return null;
    }

    if (result['data'] == null || result['data']['getUserProfile'] == null) {
      print('No data returned from the query');
      return null;
    }

    final Map<String, dynamic> userProfile = result['data']['getUserProfile'];

    // Transform the data into the desired shape
    Map<String, dynamic> transformedProfile = {
      'profileImageUrl': userProfile['profileImageUrl'],
      'gender': userProfile['gender'] == 'female' ? 'Female' : 'Male',
      'displayName': userProfile['displayName'],
      'profileCompleted': userProfile['profileCompleted'],
      'bio': userProfile['bio'],
      'birthDate': _formatDate(userProfile['birthDate']),
    };
    print('Transformed profile: $transformedProfile');
    return transformedProfile;
  }

  String _formatDate(String timestamp) {
    DateTime date = DateTime.fromMillisecondsSinceEpoch(int.parse(timestamp));
    return '${date.year}-${date.month.toString().padLeft(2, '0')}-${date.day.toString().padLeft(2, '0')}';
  }
}



// ./screens/Chat/TempChatScreen.dart

import 'package:flutter/material.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:socket_io_client/socket_io_client.dart' as IO;
import 'package:yoto/services/ChatService.dart';
import 'package:yoto/components/message_bubble.dart';
import 'package:yoto/components/chat_input.dart';
import 'package:yoto/components/timer_display.dart';
import 'package:yoto/screens/Chat/ChatScreen.dart';

class TempChatScreen extends StatefulWidget {
  final String chatId;
  final String matchedUserId;

  const TempChatScreen({
    Key? key,
    required this.chatId,
    required this.matchedUserId,
  }) : super(key: key);

  @override
  _TempChatScreenState createState() => _TempChatScreenState();
}

class _TempChatScreenState extends State<TempChatScreen> {
  final FirebaseAuth _auth = FirebaseAuth.instance;
  late IO.Socket socket;
  String _matchedUserName = "User";
  bool _isFriend = false;
  List<Map<String, dynamic>> _messages = [];
  bool _disposed = false;

  @override
  void initState() {
    super.initState();
    _setupSocketConnection();
    _fetchMatchedUserName();
  }

  void _setupSocketConnection() {
    socket = IO.io(
        'https://e682-2409-40c1-10ff-b39c-45be-1415-f564-fdc9.ngrok-free.app',
        <String, dynamic>{
          'transports': ['websocket'],
          'autoConnect': false,
        });

    socket.connect();
    socket.emit('register', _auth.currentUser!.uid);
    socket.emit('joinChat', {'chatId': widget.chatId});

    socket.on('chatHistory', (data) {
      _safeSetState(() {
        _messages = List<Map<String, dynamic>>.from(data['messages'] ?? []);
        _messages.sort((a, b) => b['timestamp'].compareTo(a['timestamp']));
      });
    });

    socket.on('newMessage', (data) {
      _safeSetState(() {
        _messages.insert(0, {
          'senderId': data['senderId'],
          'content': data['content'],
          'timestamp': data['timestamp'],
        });
      });
    });

    socket.on('friendRequestAccepted', (_) {
      _navigateToPermanentChat();
    });

    socket.on('chatEnded', (_) {
      _navigateToSearchScreen();
    });

    socket.onConnect((_) {
      print('Connected to socket server');
    });

    socket.onConnectError((error) {
      print('Connection error: $error');
    });

    socket.onError((error) {
      print('Socket error: $error');
    });
  }

  void _safeSetState(Function() setStateAction) {
    if (!_disposed) {
      setState(setStateAction);
    }
  }

  void _navigateToPermanentChat() {
    if (!_disposed) {
      Navigator.pushReplacement(
        context,
        MaterialPageRoute(
          builder: (context) => PermanentChatScreen(
            chatId: widget.chatId,
            friendId: widget.matchedUserId,
          ),
        ),
      );
    }
  }

  void _fetchMatchedUserName() {
    socket.emit('getMatchedUserName', {'userId': widget.matchedUserId});
    socket.once('matchedUserName', (data) {
      _safeSetState(() {
        _matchedUserName = data['name'];
      });
    });
  }

  void _addFriend() {
    socket.emit('sendFriendRequest', {
      'chatId': widget.chatId,
      'senderId': _auth.currentUser!.uid,
      'receiverId': widget.matchedUserId,
    });
    if (!_disposed) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('Friend request sent successfully!')),
      );
    }
  }

  void _endChat() async {
    try {
      socket.emit('endChat', {'chatId': widget.chatId});
      _navigateToSearchScreen();
    } catch (e) {
      print('Error ending chat: $e');
      if (!_disposed) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('Error ending chat. Please try again.')),
        );
      }
    }
  }

  void _navigateToSearchScreen() {
    if (!_disposed) {
      Navigator.of(context).pushNamedAndRemoveUntil('/', (route) => false);
    }
  }

  void _sendMessage(String message) {
    print('Sending message: $message');
    socket.emit('sendMessage', {
      'chatId': widget.chatId,
      'senderId': _auth.currentUser!.uid,
      'content': message,
    });
  }

  @override
  Widget build(BuildContext context) {
    return PopScope(
      canPop: false,
      onPopInvoked: (didPop) {
        if (didPop) return;
        _endChat();
      },
      child: Scaffold(
        appBar: AppBar(
          title: Text(_matchedUserName),
          actions: [
            PopupMenuButton<String>(
              onSelected: (value) {
                if (value == 'add_friend') {
                  _addFriend();
                } else if (value == 'end_chat') {
                  _endChat();
                }
              },
              itemBuilder: (BuildContext context) => <PopupMenuEntry<String>>[
                if (!_isFriend)
                  const PopupMenuItem<String>(
                    value: 'add_friend',
                    child: Text('Add Friend'),
                  ),
                const PopupMenuItem<String>(
                  value: 'end_chat',
                  child: Text('End Chat'),
                ),
              ],
            ),
          ],
        ),
        body: Column(
          children: [
            TimerDisplay(chatId: widget.chatId),
            Expanded(
              child: ListView.builder(
                reverse: true,
                itemCount: _messages.length,
                itemBuilder: (context, index) => MessageBubble(
                  message: _messages[index],
                  isMe: _messages[index]['senderId'] == _auth.currentUser!.uid,
                ),
              ),
            ),
            ChatInput(
              onSendMessage: _sendMessage,
            ),
          ],
        ),
      ),
    );
  }

  @override
  void dispose() {
    _disposed = true;
    socket.disconnect();
    super.dispose();
  }
}



// ./screens/Chat/ChatScreen.dart

import 'package:yoto/components/message_bubble_with_media.dart';
import 'package:yoto/services/AppStateService.dart';
import 'package:flutter/material.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:yoto/screens/Profile/ProfileScreen.dart';

class PermanentChatScreen extends StatefulWidget {
  final String chatId;
  final String friendId;

  const PermanentChatScreen({
    Key? key,
    required this.chatId,
    required this.friendId,
  }) : super(key: key);

  @override
  _PermanentChatScreenState createState() => _PermanentChatScreenState();
}

class _PermanentChatScreenState extends State<PermanentChatScreen> {
  final FirebaseAuth _auth = FirebaseAuth.instance;
  String _friendName = "Friend";
  List<Map<String, dynamic>> _messages = [];

  @override
  void initState() {
    super.initState();
    print("PermanentChatScreen: initState called");
    // _fetchFriendName();
    AppState.currentScreen = AppScreen.chat;
    AppState.currentChatId = widget.chatId;
  }

  @override
  void dispose() {
    print("PermanentChatScreen dispose called");
    AppState.currentScreen = AppScreen.other;
    AppState.currentChatId = null;
    super.dispose();
  }

  // Future<void> _fetchFriendName() async {
  //   print("Fetching friend name");
  //   String name = await _chatService.getMatchedUserName(widget.friendId);
  //   setState(() {
  //     _friendName = name;
  //   });
  //   print("Friend name set to: $_friendName");
  // }

  void _viewProfile() {
    print("Viewing profile");
    Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => ProfileScreen(userId: widget.friendId),
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    print("Building PermanentChatScreen. Messages: $_messages");
    return PopScope(
      canPop: false,
      onPopInvoked: (didPop) {
        if (didPop) return;
        Navigator.of(context).pushNamedAndRemoveUntil('/', (route) => false);
      },
      child: Scaffold(
        appBar: AppBar(
          title: Text(_friendName),
          actions: [
            IconButton(
              icon: Icon(Icons.person),
              onPressed: _viewProfile,
            ),
          ],
        ),
        body: Text('chatting with ${widget.chatId}'),
      ),
    );
  }
}



// ./screens/SearchScreen/SearchScreen.dart

import 'package:yoto/components/search_button.dart';
import 'package:yoto/screens/SearchScreen/MatchListener.dart';
import 'package:yoto/screens/SearchScreen/SearchAnimation.dart';
import 'package:yoto/services/LocationService.dart';
import 'package:yoto/services/ServerlessService.dart';
import 'package:flutter/material.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:geolocator/geolocator.dart';

class SearchScreen extends StatefulWidget {
  const SearchScreen({Key? key}) : super(key: key);

  @override
  State<SearchScreen> createState() => _SearchScreenState();
}

class _SearchScreenState extends State<SearchScreen> {
  final ServerlessService _apiService = ServerlessService();
  final LocationService _locationService = LocationService();
  final MatchListener _matchListener = MatchListener();
  bool _isSearching = false;
  String? _userId;
  Position? _currentPosition;

  @override
  void initState() {
    super.initState();
    _userId = FirebaseAuth.instance.currentUser?.uid;
    _initializeLocation();
  }

  Future<void> _initializeLocation() async {
    _currentPosition = await _locationService.getCurrentLocation(context);
  }

  void startSearch() async {
    if (_userId == null) return;

    setState(() {
      _isSearching = true;
    });

    try {
      Map<String, dynamic> requestBody = {
        'userId': _userId,
      };

      if (_currentPosition != null) {
        requestBody['location'] = {
          'latitude': _currentPosition!.latitude,
          'longitude': _currentPosition!.longitude,
        };
      }

      await _apiService.addToMatchQueue(requestBody);
      _matchListener.listenForNewMatches(context, stopAnimation);
    } catch (e) {
      print("Error during search process: $e");
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('Error starting search: $e')),
      );
      stopAnimation();
    }
  }

  void stopAnimation() {
    setState(() {
      _isSearching = false;
    });
  }

  void stopSearch() async {
    stopAnimation();
    try {
      await _apiService.removeFromMatchQueue();
    } catch (e) {
      print('Error stopping search: $e');
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            if (_isSearching) SearchAnimation(),
            const SizedBox(height: 20),
            SearchButton(
              isSearching: _isSearching,
              onStartSearch: startSearch,
              onStopSearch: stopSearch,
            ),
          ],
        ),
      ),
    );
  }

  @override
  void dispose() {
    _matchListener.dispose();
    super.dispose();
  }
}



// ./screens/SearchScreen/MatchListener.dart

import 'dart:async';

import 'package:flutter/material.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:yoto/screens/Chat/TempChatScreen.dart';

class MatchListener {
  StreamSubscription<QuerySnapshot>? _matchListener;

  void listenForNewMatches(BuildContext context, Function stopAnimation) {
    final user = FirebaseAuth.instance.currentUser;
    if (user != null) {
      _matchListener = FirebaseFirestore.instance
          .collection('chats-v2')
          .where('users', arrayContains: user.uid)
          .snapshots()
          .listen((snapshot) {
        for (var change in snapshot.docChanges) {
          if (change.type == DocumentChangeType.added) {
            _handleNewMatch(context, change.doc, user.uid, stopAnimation);
          }
        }
      }, onError: (error) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
              content: Text('Error occurred while listening to match $error')),
        );
      });
    }
  }

  void _handleNewMatch(BuildContext context, DocumentSnapshot doc,
      String userId, Function stopAnimation) {
    print('New match found: ${doc.id}');
    Map<String, dynamic> chatData = doc.data() as Map<String, dynamic>;
    if (chatData['isPermanent'] != true) {
      String otherUserId =
          (chatData['users'] as List<dynamic>).firstWhere((id) => id != userId);
      stopAnimation();
      Navigator.of(context).push(MaterialPageRoute(
        builder: (context) => TempChatScreen(
          chatId: doc.id,
          matchedUserId: otherUserId,
        ),
      ));
    }
  }

  void dispose() {
    _matchListener?.cancel();
  }
}



// ./screens/SearchScreen/SearchAnimation.dart

import 'package:flutter/material.dart';

class SearchAnimation extends StatefulWidget {
  @override
  _SearchAnimationState createState() => _SearchAnimationState();
}

class _SearchAnimationState extends State<SearchAnimation>
    with SingleTickerProviderStateMixin {
  late AnimationController _animationController;
  late Animation<double> _scaleAnimation;

  @override
  void initState() {
    super.initState();
    _setupAnimation();
  }

  void _setupAnimation() {
    _animationController = AnimationController(
      duration: const Duration(milliseconds: 1000),
      vsync: this,
    )..repeat(reverse: true);

    _scaleAnimation = Tween<double>(begin: 0.9, end: 1.0).animate(
      CurvedAnimation(
        parent: _animationController,
        curve: Curves.easeInOut,
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    return AnimatedBuilder(
      animation: _scaleAnimation,
      builder: (BuildContext context, Widget? child) {
        return Transform.scale(
          scale: _scaleAnimation.value,
          child: Container(
            width: 200,
            height: 200,
            decoration: const BoxDecoration(
              shape: BoxShape.circle,
              color: Colors.blue,
            ),
            child: const Icon(
              Icons.search,
              color: Colors.white,
              size: 50,
            ),
          ),
        );
      },
    );
  }

  @override
  void dispose() {
    _animationController.dispose();
    super.dispose();
  }
}



// ./screens/FriendsList/FriendsListScreen.dart

import 'package:yoto/services/SocketService.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';

class FriendsListScreen extends StatefulWidget {
  FriendsListScreen();

  @override
  _FriendsListScreenState createState() => _FriendsListScreenState();
}

class _FriendsListScreenState extends State<FriendsListScreen> {
  late SocketService _socketService;
  List<Map<String, dynamic>> _friendsList = [];
  final String userId = FirebaseAuth.instance.currentUser!.uid;
  @override
  void initState() {
    super.initState();
    _socketService = SocketService(userId);
    _socketService.onFriendsListUpdate = _updateFriendsList;
    _socketService.onUserProfileUpdate = _handleUserProfileUpdate;
    _socketService.connect();
  }

  void _updateFriendsList(List<Map<String, dynamic>> newList) {
    setState(() {
      _friendsList = newList;
    });
  }

  void _handleUserProfileUpdate(Map<String, dynamic> update) {
    // Update the relevant friend's profile in the list
    setState(() {
      _friendsList = _friendsList.map((friend) {
        if (friend['friendId'] == update['userId']) {
          return {
            ...friend,
            'displayName': update['displayName'] ?? friend['displayName'],
            'profileImageUrl':
                update['profileImageUrl'] ?? friend['profileImageUrl'],
          };
        }
        return friend;
      }).toList();
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('Friends')),
      body: _friendsList.isEmpty
          ? Center(child: CircularProgressIndicator())
          : ListView.builder(
              itemCount: _friendsList.length,
              itemBuilder: (context, index) {
                final friend = _friendsList[index];
                return ListTile(
                  leading: CircleAvatar(
                    backgroundImage:
                        NetworkImage(friend['profileImageUrl'] ?? ''),
                  ),
                  title: Text(friend['displayName'] ?? 'Unknown'),
                  subtitle: Text(friend['lastMessage'] ?? 'No messages yet'),
                  trailing: friend['unreadCount'] > 0
                      ? CircleAvatar(
                          radius: 10,
                          backgroundColor: Colors.red,
                          child: Text(
                            friend['unreadCount'].toString(),
                            style: TextStyle(color: Colors.white, fontSize: 12),
                          ),
                        )
                      : null,
                  // Add onTap handler to navigate to chat screen
                );
              },
            ),
    );
  }

  @override
  void dispose() {
    _socketService.disconnect();
    super.dispose();
  }
}



// ./screens/Profile/ProfileScreen.dart

import 'package:yoto/services/GraphQLService.dart';
import 'package:flutter/material.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:yoto/screens/Profile/ProfileEditScreen.dart';

class ProfileScreen extends StatefulWidget {
  final String? userId;

  ProfileScreen({Key? key, this.userId}) : super(key: key);

  @override
  _ProfileScreenState createState() => _ProfileScreenState();
}

class _ProfileScreenState extends State<ProfileScreen> {
  final FirebaseAuth _auth = FirebaseAuth.instance;
  Map<String, dynamic>? userData;
  bool isCurrentUser = false;

  @override
  void initState() {
    super.initState();
    isCurrentUser =
        widget.userId == null || widget.userId == _auth.currentUser?.uid;
    _loadUserData();
  }

  Future<void> _loadUserData() async {
    Map<String, dynamic>? user = await Graphqlservice().getUserProfile();
    setState(() {
      userData = user;
    });
  }

  void _editProfile() {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) => ProfileEditScreen()),
    ).then((_) => _loadUserData());
  }

  void _logout() async {
    await _auth.signOut();
    Navigator.of(context).pushReplacementNamed('/auth');
  }

  void _showFullScreenImage() {
    Navigator.of(context).push(MaterialPageRoute<void>(
      builder: (BuildContext context) {
        return Scaffold(
          backgroundColor: Colors.black,
          body: GestureDetector(
            onTap: () => Navigator.of(context)
                .pop(), // This will return to the profile page
            child: Center(
              child: Image.network(
                userData!['profileImageUrl'] ??
                    'https://via.placeholder.com/400x200',
                fit: BoxFit.contain,
              ),
            ),
          ),
        );
      },
    ));
  }

  @override
  Widget build(BuildContext context) {
    if (userData == null) {
      return Scaffold(body: Center(child: CircularProgressIndicator()));
    }

    return Scaffold(
      body: CustomScrollView(
        slivers: <Widget>[
          SliverAppBar(
            expandedHeight: 200.0,
            floating: false,
            pinned: true,
            flexibleSpace: FlexibleSpaceBar(
              background: GestureDetector(
                onTap: _showFullScreenImage,
                child: Image.network(
                  userData!['profileImageUrl'] ??
                      'https://via.placeholder.com/400x200',
                  fit: BoxFit.cover,
                ),
              ),
            ),
            actions: isCurrentUser
                ? [
                    IconButton(icon: Icon(Icons.edit), onPressed: _editProfile),
                    IconButton(icon: Icon(Icons.logout), onPressed: _logout),
                  ]
                : null,
          ),
          SliverToBoxAdapter(
            child: Container(
              decoration: BoxDecoration(
                color: Theme.of(context).scaffoldBackgroundColor,
                borderRadius: BorderRadius.only(
                  topLeft: Radius.circular(30),
                  topRight: Radius.circular(30),
                ),
              ),
              child: Padding(
                padding: EdgeInsets.all(16),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    Text(
                      userData!['displayName'] ?? 'No Name',
                      style:
                          TextStyle(fontSize: 24, fontWeight: FontWeight.bold),
                    ),
                    if (isCurrentUser)
                      Text(
                        _auth.currentUser?.email ?? 'No Email',
                        style: TextStyle(fontSize: 16, color: Colors.grey),
                      ),
                    SizedBox(height: 20),
                    _buildInfoTile(Icons.info_outline, 'About',
                        userData!['bio'] ?? 'No bio available'),
                    SizedBox(height: 16),
                    _buildInfoTile(
                      Icons.cake,
                      'Birth Date',
                      userData!['birthDate'] != null
                          ? 'Born ${userData!['birthDate']}'
                          : 'Birth date not set',
                    ),
                    SizedBox(height: 16),
                    _buildInfoTile(
                      userData!['gender'] == 'Male' ? Icons.male : Icons.female,
                      'Gender',
                      userData!['gender'] ?? 'Gender not set',
                    ),
                  ],
                ),
              ),
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildInfoTile(IconData icon, String title, String content) {
    return Row(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Icon(icon, size: 20, color: Colors.grey),
        SizedBox(width: 16),
        Expanded(
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              Text(
                title,
                style: TextStyle(fontSize: 16, fontWeight: FontWeight.bold),
              ),
              SizedBox(height: 4),
              Text(
                content,
                style: TextStyle(fontSize: 16),
              ),
            ],
          ),
        ),
      ],
    );
  }
}



// ./screens/Profile/ProfileEditScreen.dart

import 'dart:typed_data';

import 'package:yoto/services/GraphQLService.dart';
import 'package:yoto/services/ServerlessService.dart';
import 'package:flutter/material.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:image_picker/image_picker.dart';
import 'package:firebase_storage/firebase_storage.dart';
import 'package:flutter/foundation.dart' show kIsWeb;
import 'dart:io';

class ProfileEditScreen extends StatefulWidget {
  final bool isNewUser;

  const ProfileEditScreen({Key? key, this.isNewUser = false}) : super(key: key);

  @override
  _ProfileEditScreenState createState() => _ProfileEditScreenState();
}

class _ProfileEditScreenState extends State<ProfileEditScreen> {
  final _formKey = GlobalKey<FormState>();
  final _nameController = TextEditingController();
  final _bioController = TextEditingController();
  final ValueNotifier<DateTime?> _birthDate = ValueNotifier<DateTime?>(null);
  final ValueNotifier<String?> _gender = ValueNotifier<String?>(null);
  dynamic _imageFile;
  String? _imageUrl;
  Uint8List? _webImage;
  bool _isLoading = false;
  bool isNew = false;
  @override
  void initState() {
    super.initState();
    _loadUserData();
  }

  Future<void> _loadUserData() async {
    if (!widget.isNewUser) {
      Map<String, dynamic>? userData = await Graphqlservice().getUserProfile();
      if (userData != null) {
        _nameController.text = userData['displayName'] ?? '';
        _bioController.text = userData['bio'] ?? '';
        _birthDate.value = DateTime.parse(userData['birthDate']);
        _gender.value = userData['gender'];
        _imageUrl = userData['profileImageUrl'];
        setState(() {
          isNew = false;
        }); // Trigger a rebuild with the loaded data
      }
      setState(() {
        isNew = true;
      });
    }
  }

  Future<void> _pickImage() async {
    final ImagePicker _picker = ImagePicker();
    final XFile? image = await _picker.pickImage(source: ImageSource.gallery);
    if (image != null) {
      setState(() {
        if (kIsWeb) {
          _webImage = Uint8List.fromList(File(image.path).readAsBytesSync());
          _imageFile = null;
        } else {
          _imageFile = File(image.path);
          _webImage = null;
        }
      });
    }
  }

  Future<void> _saveProfile() async {
    try {
      if (_formKey.currentState!.validate()) {
        setState(() {
          _isLoading = true;
        });

        final user = FirebaseAuth.instance.currentUser;
        if (user != null) {
          String? imageUrl = _imageUrl;
          if (_webImage != null || _imageFile != null) {
            final ref = FirebaseStorage.instance
                .ref()
                .child('user_profiles/${user.uid}');
            if (kIsWeb) {
              await ref.putData(_webImage!);
            } else {
              await ref.putFile(_imageFile);
            }
            imageUrl = await ref.getDownloadURL();
          }

          await ServerlessService().updateProfile({
            'displayName': _nameController.text,
            'bio': _bioController.text,
            'birthDate': _birthDate.value,
            'gender': _gender.value?.toLowerCase(),
            'profileImageUrl': imageUrl,
            'profileCompleted': true,
          }, isNew: isNew);

          setState(() {
            _isLoading = false;
          });

          Navigator.of(context).pushReplacementNamed('/home');
        }
      }
    } on Exception catch (e) {
      // toast error message
      print(e);
      setState(() {
        _isLoading = false;
      });
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text(e.toString())),
      );
    }
  }

  @override
  Widget build(BuildContext context) {
    final isDarkMode = Theme.of(context).brightness == Brightness.dark;
    final primaryColor = Theme.of(context).primaryColor;

    return Scaffold(
      appBar: AppBar(
        title: Text(widget.isNewUser ? 'Create Profile' : 'Edit Profile'),
        backgroundColor: primaryColor,
        elevation: 0,
      ),
      body: Stack(
        children: [
          Container(
            height: MediaQuery.of(context).size.height * 0.3,
            color: primaryColor,
          ),
          SingleChildScrollView(
            child: Column(
              children: [
                SizedBox(height: 20),
                _buildProfileImage(isDarkMode),
                SizedBox(height: 20),
                Container(
                  decoration: BoxDecoration(
                    color: isDarkMode ? Colors.grey[900] : Colors.white,
                    borderRadius: BorderRadius.only(
                      topLeft: Radius.circular(30),
                      topRight: Radius.circular(30),
                    ),
                  ),
                  child: Padding(
                    padding: const EdgeInsets.all(20.0),
                    child: Form(
                      key: _formKey,
                      child: Column(
                        crossAxisAlignment: CrossAxisAlignment.start,
                        children: [
                          _buildTextField(
                            controller: _nameController,
                            label: 'Name',
                            icon: Icons.person,
                            validator: (value) {
                              if (value == null || value.isEmpty) {
                                return 'Please enter a name';
                              }
                              return null;
                            },
                          ),
                          SizedBox(height: 20),
                          _buildTextField(
                            controller: _bioController,
                            label: 'About',
                            icon: Icons.info_outline,
                            maxLines: 3,
                            validator: (value) {
                              if (value == null || value.isEmpty) {
                                return 'Please enter a bio';
                              }
                              return null;
                            },
                          ),
                          SizedBox(height: 20),
                          _buildDatePicker(isDarkMode),
                          SizedBox(height: 20),
                          _buildGenderDropdown(isDarkMode),
                          SizedBox(height: 30),
                          _buildSaveButton(primaryColor),
                        ],
                      ),
                    ),
                  ),
                ),
              ],
            ),
          ),
          if (_isLoading)
            Container(
              color: Colors.black.withOpacity(0.5),
              child: Center(
                child: CircularProgressIndicator(
                  valueColor: AlwaysStoppedAnimation<Color>(primaryColor),
                ),
              ),
            ),
        ],
      ),
    );
  }

  Widget _buildProfileImage(bool isDarkMode) {
    return GestureDetector(
      onTap: _isLoading ? null : _pickImage,
      child: Stack(
        alignment: Alignment.center,
        children: [
          CircleAvatar(
            radius: 75,
            backgroundColor: isDarkMode ? Colors.grey[800] : Colors.white,
            child: CircleAvatar(
              radius: 70,
              backgroundColor: isDarkMode ? Colors.grey[700] : Colors.grey[200],
              backgroundImage: _getImageProvider(),
              child:
                  _imageFile == null && _webImage == null && _imageUrl == null
                      ? Icon(Icons.person,
                          size: 70,
                          color: isDarkMode ? Colors.white70 : Colors.grey[600])
                      : null,
            ),
          ),
          Positioned(
            bottom: 0,
            right: 0,
            child: CircleAvatar(
              backgroundColor: Theme.of(context).primaryColor,
              radius: 25,
              child: Icon(Icons.camera_alt, color: Colors.white, size: 20),
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildTextField({
    required TextEditingController controller,
    required String label,
    required IconData icon,
    int maxLines = 1,
    String? Function(String?)? validator,
  }) {
    return TextFormField(
      controller: controller,
      decoration: InputDecoration(
        labelText: label,
        prefixIcon: Icon(icon),
        border: OutlineInputBorder(
          borderRadius: BorderRadius.circular(15),
        ),
        filled: true,
        fillColor: Theme.of(context).brightness == Brightness.dark
            ? Colors.grey[800]
            : Colors.grey[100],
      ),
      maxLines: maxLines,
      enabled: !_isLoading,
      validator: validator,
    );
  }

  Widget _buildDatePicker(bool isDarkMode) {
    return ValueListenableBuilder<DateTime?>(
      valueListenable: _birthDate,
      builder: (context, date, child) {
        return FormField<DateTime>(
          initialValue: date,
          validator: (value) {
            if (value == null) {
              return 'Please select your birth date';
            }
            if (!_isOver18(value)) {
              return 'You must be 18 years or older';
            }
            return null;
          },
          builder: (FormFieldState<DateTime> state) {
            return Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                InkWell(
                  onTap: _isLoading
                      ? null
                      : () async {
                          final DateTime? picked = await showDatePicker(
                            context: context,
                            initialDate: date ??
                                DateTime.now().subtract(Duration(days: 6570)),
                            firstDate: DateTime(1900),
                            lastDate: DateTime.now(),
                          );
                          if (picked != null && picked != date) {
                            _birthDate.value = picked;
                            state.didChange(picked);
                          }
                        },
                  child: InputDecorator(
                    decoration: InputDecoration(
                      labelText: 'Birth Date',
                      prefixIcon: Icon(Icons.calendar_today),
                      border: OutlineInputBorder(
                        borderRadius: BorderRadius.circular(15),
                      ),
                      filled: true,
                      fillColor:
                          isDarkMode ? Colors.grey[800] : Colors.grey[100],
                    ),
                    child: Text(
                      date == null
                          ? 'Select Birth Date'
                          : '${date.toLocal().toString().split(' ')[0]}',
                    ),
                  ),
                ),
                if (state.hasError)
                  Padding(
                    padding: const EdgeInsets.only(left: 12, top: 8),
                    child: Text(
                      state.errorText!,
                      style: TextStyle(color: Colors.red, fontSize: 12),
                    ),
                  ),
              ],
            );
          },
        );
      },
    );
  }

  Widget _buildGenderDropdown(bool isDarkMode) {
    return ValueListenableBuilder<String?>(
      valueListenable: _gender,
      builder: (context, gender, child) {
        return DropdownButtonFormField<String>(
          value: gender,
          decoration: InputDecoration(
            labelText: 'Gender',
            prefixIcon: Icon(Icons.person_outline),
            border: OutlineInputBorder(
              borderRadius: BorderRadius.circular(15),
            ),
            filled: true,
            fillColor: isDarkMode ? Colors.grey[800] : Colors.grey[100],
          ),
          items: ['Male', 'Female'].map((String value) {
            return DropdownMenuItem<String>(
              value: value,
              child: Text(value),
            );
          }).toList(),
          onChanged: _isLoading
              ? null
              : (newValue) {
                  _gender.value = newValue;
                },
          validator: (value) {
            if (value == null || value.isEmpty) {
              return 'Please select a gender';
            }
            return null;
          },
        );
      },
    );
  }

  Widget _buildSaveButton(Color primaryColor) {
    return SizedBox(
      width: double.infinity,
      child: ElevatedButton(
        onPressed: _isLoading ? null : _saveProfile,
        child: Padding(
          padding: const EdgeInsets.symmetric(vertical: 16.0),
          child: Text(
            'Save Profile',
            style: TextStyle(fontSize: 18),
          ),
        ),
        style: ElevatedButton.styleFrom(
          backgroundColor: primaryColor,
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(15),
          ),
        ),
      ),
    );
  }

  ImageProvider? _getImageProvider() {
    if (_webImage != null) {
      return MemoryImage(_webImage!);
    } else if (_imageFile != null) {
      return FileImage(_imageFile);
    } else if (_imageUrl != null) {
      return NetworkImage(_imageUrl!);
    }
    return null;
  }

  bool _isOver18(DateTime birthDate) {
    final today = DateTime.now();
    final difference = today.difference(birthDate).inDays;
    return difference >=
        6570; // 6570 days = 18 years (accounting for leap years)
  }
}



// ./screens/Home/HomeScreen.dart

import 'package:flutter/material.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:socket_io_client/socket_io_client.dart' as IO;
import 'package:yoto/screens/FriendsList/FriendsListScreen.dart';
import 'package:yoto/screens/SearchScreen/SearchScreen.dart';
import 'package:yoto/screens/Profile/ProfileScreen.dart';

class HomeScreen extends StatefulWidget {
  const HomeScreen({Key? key}) : super(key: key);

  @override
  _HomeScreenState createState() => _HomeScreenState();
}

class _HomeScreenState extends State<HomeScreen> {
  int _currentIndex = 0;
  late IO.Socket socket;
  final FirebaseAuth _auth = FirebaseAuth.instance;
  final List<Widget> _screens = [
    FriendsListScreen(),
    SearchScreen(),
    ProfileScreen(),
  ];

  @override
  void initState() {
    // TODO: implement initState
    super.initState();
    _setupSocketConnection();
  }

  void _setupSocketConnection() {
    socket = IO.io(
        'https://e682-2409-40c1-10ff-b39c-45be-1415-f564-fdc9.ngrok-free.app',
        <String, dynamic>{
          'transports': ['websocket'],
          'autoConnect': false,
        });

    socket.connect();
    socket.emit('register', _auth.currentUser!.uid);
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: AnimatedSwitcher(
        duration: Duration(milliseconds: 300),
        transitionBuilder: (Widget child, Animation<double> animation) {
          return FadeTransition(
            opacity: animation,
            child: child,
          );
        },
        child: _screens[_currentIndex],
      ),
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: _currentIndex,
        onTap: (index) {
          setState(() {
            _currentIndex = index;
          });
        },
        items: [
          BottomNavigationBarItem(
            icon: Icon(Icons.people_outline),
            activeIcon: Icon(Icons.people),
            label: 'Friends',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.search_outlined),
            activeIcon: Icon(Icons.search),
            label: 'Search',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.person_outline),
            activeIcon: Icon(Icons.person),
            label: 'Profile',
          ),
        ],
        selectedItemColor: Colors.black,
        unselectedItemColor: Colors.grey,
        showUnselectedLabels: true,
      ),
    );
  }
}



// ./firebase_options.dart

// File generated by FlutterFire CLI.
// ignore_for_file: lines_longer_than_80_chars, avoid_classes_with_only_static_members
import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;
import 'package:flutter/foundation.dart'
    show defaultTargetPlatform, kIsWeb, TargetPlatform;

/// Default [FirebaseOptions] for use with your Firebase apps.
///
/// Example:
/// ```dart
/// import 'firebase_options.dart';
/// // ...
/// await Firebase.initializeApp(
///   options: DefaultFirebaseOptions.currentPlatform,
/// );
/// ```
class DefaultFirebaseOptions {
  static FirebaseOptions get currentPlatform {
    if (kIsWeb) {
      return web;
    }
    switch (defaultTargetPlatform) {
      case TargetPlatform.android:
        return android;
      case TargetPlatform.iOS:
        return ios;
      case TargetPlatform.macOS:
        return macos;
      case TargetPlatform.windows:
        return windows;
      case TargetPlatform.linux:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for linux - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      default:
        throw UnsupportedError(
          'DefaultFirebaseOptions are not supported for this platform.',
        );
    }
  }

  static const FirebaseOptions web = FirebaseOptions(
    apiKey: 'AIzaSyCUoIB-Ng-im33Ii9B9O49MjGkSFJsHoJw',
    appId: '1:327775764664:web:94b48eae272a9da559344d',
    messagingSenderId: '327775764664',
    projectId: 'flutter-c91c8',
    authDomain: 'flutter-c91c8.firebaseapp.com',
    databaseURL: 'https://flutter-c91c8-default-rtdb.asia-southeast1.firebasedatabase.app',
    storageBucket: 'flutter-c91c8.appspot.com',
    measurementId: 'G-V327W8PRSZ',
  );

  static const FirebaseOptions android = FirebaseOptions(
    apiKey: 'AIzaSyDf5YW44ebirOb4CQU2TOkGA_cFcq2LEE0',
    appId: '1:327775764664:android:467af3283cb965d059344d',
    messagingSenderId: '327775764664',
    projectId: 'flutter-c91c8',
    databaseURL: 'https://flutter-c91c8-default-rtdb.asia-southeast1.firebasedatabase.app',
    storageBucket: 'flutter-c91c8.appspot.com',
  );

  static const FirebaseOptions ios = FirebaseOptions(
    apiKey: 'AIzaSyCooTlr8MPr8ssgBct0YRuyW_v2ogVSEKE',
    appId: '1:327775764664:ios:dbea90814185020459344d',
    messagingSenderId: '327775764664',
    projectId: 'flutter-c91c8',
    databaseURL: 'https://flutter-c91c8-default-rtdb.asia-southeast1.firebasedatabase.app',
    storageBucket: 'flutter-c91c8.appspot.com',
    iosClientId: '327775764664-n9faega4pj87gt6ovr4qvhq8uusrkumh.apps.googleusercontent.com',
    iosBundleId: 'com.example.chatApp',
  );

  static const FirebaseOptions macos = FirebaseOptions(
    apiKey: 'AIzaSyCooTlr8MPr8ssgBct0YRuyW_v2ogVSEKE',
    appId: '1:327775764664:ios:dbea90814185020459344d',
    messagingSenderId: '327775764664',
    projectId: 'flutter-c91c8',
    databaseURL: 'https://flutter-c91c8-default-rtdb.asia-southeast1.firebasedatabase.app',
    storageBucket: 'flutter-c91c8.appspot.com',
    iosClientId: '327775764664-n9faega4pj87gt6ovr4qvhq8uusrkumh.apps.googleusercontent.com',
    iosBundleId: 'com.example.chatApp',
  );

  static const FirebaseOptions windows = FirebaseOptions(
    apiKey: 'AIzaSyCUoIB-Ng-im33Ii9B9O49MjGkSFJsHoJw',
    appId: '1:327775764664:web:174be248f1dd3e6459344d',
    messagingSenderId: '327775764664',
    projectId: 'flutter-c91c8',
    authDomain: 'flutter-c91c8.firebaseapp.com',
    databaseURL: 'https://flutter-c91c8-default-rtdb.asia-southeast1.firebasedatabase.app',
    storageBucket: 'flutter-c91c8.appspot.com',
    measurementId: 'G-K744E64FQ9',
  );

}